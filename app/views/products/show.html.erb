<div class="flex w-full max-w-2xl mx-auto">
  <div class="w-full mx-auto">
    <%= render 'shared/flash' if flash.any? %>
    <h1 class="self-end mt-5 mb-2 text-xl font-bold text-marche_orange" >檢視商品</h1>
    <%# 商品基本欄位 %>
    <div class="flex w-full grid grid-cols-2">
      <%# 圖片 %>
      <header class="mr-5 ">
        <div class="w-100 h-100">
          <img src="https://fakeimg.pl/350x400/ff0000,128/000,255" class="w-full">
        </div>
        <%# 喜歡功能 %>
        <div data-controller="product--like" data-product-id="<%=@product.id%>" data-user-like="<%=current_user&.like_product?(@product)%>">
          <i class="fa-regular fa-heart fa-xl text-rose-600 hover:animate-bounce" data-action="click->product--like#like_product" data-product--like-target="heart"></i>
          <span>Like商品(<span data-product--like-target="amount"><%= @product.product_likes.count%></span>)</span>
        </div>
      </header>
      <%# 資訊詳情 %> 
      <section class="py-2 px-4 flex flex-col justify-around" id="sale_info_list">
        <div class="my-5">
          <strong class="block mb-1 font-normal text-xl "><%= @product.name %></strong>
        </div>
        <div class="my-5 bg-gray-50 py-1 px-2 align-middle">
          <strong class="block mb-1 font-bold text-2xl text-red-700" >$<%= @sale_info.price %></strong>
        </div>
        <div class="my-5 flex">
        <% @sale_info_all.each do |s| %>
          <div id="sale-info-<%= s.id %>" class="sale-info">
            <button class="mb-1 font-medium border px-2 py-1 inline text-gray-900 mr-3"><%= s.spec %></button>
          </div>
        <% end %>
        </div>
        <div class="my-5">
          <%= form_with(model: @cart_product, url: cart_path, method: :post, data: { turbo: false, controller: "product--cart-product" }) do |form| %>
            <div class="flex mb-10">
              <%= form.hidden_field :sale_info_id, value: @sale_info.id, data: { product__cart_product_target: "saleInfoId" } %>
              <div class="flex items-center">
                <p class="text-gray-500 text-xs" >數量：</p>
                <%# Quantity_button %>
                <div class="flex items-center m-2" data-product--cart-product-target="inputArea">
                  <button class="quantity-btn-left-arrow" data-action="click->product--cart-product#decrement">－</button>
                    <%= form.number_field :quantity, data: { product__cart_product_target: "quantity", action:"change->product--cart-product#updateQuantity" }, class: "quantity-btn-center-input"%>
                  <button class="quantity-btn-right-arrow" data-action="click->product--cart-product#increment">＋</button>
                </div>
                <p data-product--cart-product-target="storage" class="text-gray-500 text-xs">還剩<%= @sale_info.storage%>件</p>
              </div>
            </div >
            <%= form.submit "加入購物車", class: "bg-orange-500 text-white px-4 py-2 rounded-xs hover:bg-orange-600", data: { action: "click->product--cart-product#send"}, remote: true %>
          <% end %>
        </div>
      </section>
    </div>
    <%# 商品詳情 %>
    <section>
      <div class="my-5">
        <strong class="block mb-1 font-medium">描述:</strong>
        <%= @product.description %>
      </div>
    </section>
  </div>
</div>
<%# Comment %>
<div class="max-w-2xl mx-auto ">
  <%# 留言輸入區 %>
  <h2 class="m-1 text-lg font-bold">商品評價</h2>
  <%= render partial: 'comments/comment_ranking', locals: {average_rating: @average_rating, product: @product} %>
  <% if user_signed_in? %>
    <%= form_with model: @product_comment, url: product_comments_path(@product.id) do |f| %>
      <div class="flex">
        <%= f.label "留下評論：", class: 'label'%>
        <div class="rating rating-md">
          <%= f.radio_button :rating, get_star_number(:star_0), class: "comment-star-hidden" , checked: "checked" %>
          <%= f.radio_button :rating, get_star_number(:star_1), class: "comment-star" %>
          <%= f.radio_button :rating, get_star_number(:star_2), class: "comment-star" %>
          <%= f.radio_button :rating, get_star_number(:star_3), class: "comment-star" %>
          <%= f.radio_button :rating, get_star_number(:star_4), class: "comment-star" %>
          <%= f.radio_button :rating, get_star_number(:star_5), class: "comment-star"%>
        </div>
      </div>
      <div class="flex items-end">
        <%= f.text_area :content, class: "comment-textarea w-full max-w-xs"%>
        <%= f.submit "Send", class: "comment-btn-sm" %>
      </div>
    <% end %>
  <% end %>
  <%# 當前產品評論 %>
  <section>
    <h3 class="m-2">評論：</h3>
    <div id="comment-list">
      <%= render partial: 'comments/comment', collection: @comment_records %>
    </div>
    <div class="flex justify-center my-4"><%== pagy_nav(@pagy) if @pagy.pages > 1 %></div>
  </section>
</div>